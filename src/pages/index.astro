---
import herramientas from '../data/herramientas.json';

import Layout from '../Components/Layout.astro';

interface Tool {
  titulo: string;
  descripcion_corta: string;
  uso_principal: string;
  url: string;
  url_limpia: string;
  categoria: string; // Ahora es obligatoria por tu nuevo script
}

const typedHerramientas: Tool[] = herramientas as Tool[];

// Obtenemos las categorías únicas para generar los botones automáticamente
const categoriasUnicas = [...new Set(typedHerramientas.map(h => h.categoria))];
---


<Layout>
<main class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grow">
    <div class="text-center mb-12 sm:mb-20">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight mb-4">
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-teal-400">
                Explora el Mundo de la IA
            </span>
        </h1>
        <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-400 font-light max-w-2xl mx-auto">
            Más de {typedHerramientas.length} herramientas seleccionadas para potenciar tu trabajo
        </p>
    </div>

    <div class="flex flex-wrap justify-center gap-2 mb-12">
        <button 
            onclick="filtrar('todas', this)" 
            class="filter-btn active px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest border border-blue-500 bg-blue-500 text-white transition-all"
        >
            Todas
        </button>
        {categoriasUnicas.map(cat => (
            <button 
                onclick={`filtrar('${cat}', this)`} 
                class="filter-btn px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest border border-gray-700 text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-all"
            >
                {cat}
            </button>
        ))}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="grid-herramientas">
        {typedHerramientas.map((h) => (
            <div 
                class="tool-card bg-[#151e32] rounded-xl shadow-lg hover:shadow-2xl dark:border border-gray-800 transition-all duration-300 transform hover:-translate-y-1 overflow-hidden p-8 flex flex-col items-center text-center"
                data-categoria={h.categoria}
            >
                <div class="mb-6 w-16 h-16 bg-white rounded-lg p-2 flex items-center justify-center shadow-inner">
                    <img 
                        src={`https://logo.clearbit.com/${h.url_limpia}`} 
                        alt={h.titulo}
                        class="max-w-full max-h-full object-contain"
                        onerror="this.src='https://www.google.com/s2/favicons?domain=' + this.dataset.domain + '&sz=128'"
                        data-domain={h.url_limpia}
                    />
                </div>

                <span class="text-[10px] font-bold text-blue-400 uppercase tracking-[0.2em] mb-2">{h.categoria}</span>

                <h3 class="text-2xl font-bold text-white mb-3 hover:text-blue-500 transition-colors ">
                    {h.titulo}
                </h3>
                
                <p class="text-gray-400 text-sm leading-relaxed mb-8 line-clamp-2">
                    {h.descripcion_corta}
                </p>

                <a 
                    href={`/${h.titulo.toLowerCase().replace(/\s+/g, '-')}`}
                    class="mt-auto inline-flex items-center text-blue-500 font-semibold text-sm tracking-wide hover:text-blue-400 transition-colors uppercase"
                >
                    Ver reseña completa
                    <span class="material-icons text-base ml-1">arrow_forward</span>
                </a>
            </div>
        ))}
    </div>

</main>

<script is:inline>
    function filtrar(categoria, elemento) {
        const cards = document.querySelectorAll('.tool-card');
        const buttons = document.querySelectorAll('.filter-btn');

        // 1. Resetear todos los botones a gris
        buttons.forEach(btn => {
            btn.classList.remove('bg-blue-500', 'text-white', 'border-blue-500');
            btn.classList.add('border-gray-700', 'text-gray-400');
        });

        // 2. Activar el botón clickeado
        if (elemento) {
            elemento.classList.remove('border-gray-700', 'text-gray-400');
            elemento.classList.remove('hover:text-blue-500');
            elemento.classList.add('bg-blue-500', 'text-white', 'border-blue-500');
        }

        // 3. Filtrar las tarjetas
        cards.forEach(card => {
            if (categoria === 'todas' || card.getAttribute('data-categoria') === categoria) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    }
</script>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

</Layout>